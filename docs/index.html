<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-idprovider.html">idprovider</a><ul class='methods'><li data-type='method'><a href="module-idprovider.html#.get">get</a></li><li data-type='method'><a href="module-idprovider.html#.handle401">handle401</a></li><li data-type='method'><a href="module-idprovider.html#.login">login</a></li><li data-type='method'><a href="module-idprovider.html#.logout">logout</a></li><li data-type='method'><a href="module-idprovider.html#.post">post</a></li></ul></li><li><a href="module-lib_adfs-id-provider.html">lib/adfs-id-provider</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider.html#.handleIdProviderRequest">handleIdProviderRequest</a></li></ul></li><li><a href="module-lib_adfs-id-provider_array.html">lib/adfs-id-provider/array</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_array.html#.inFirstButNotInSecond">inFirstButNotInSecond</a></li></ul></li><li><a href="module-lib_adfs-id-provider_auth.html">lib/adfs-id-provider/auth</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_auth.html#.handleLogoutRequest">handleLogoutRequest</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth.html#~getRedirectAfterLogoutUrl">getRedirectAfterLogoutUrl</a></li></ul></li><li><a href="module-lib_adfs-id-provider_auth_group.html">lib/adfs-id-provider/auth/group</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_auth_group.html#.createAndUpdateGroupsFromJwt">createAndUpdateGroupsFromJwt</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_group.html#~addUser">addUser</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_group.html#~createOrModify">createOrModify</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_group.html#~removeUser">removeUser</a></li></ul></li><li><a href="module-lib_adfs-id-provider_auth_sanitizeName.html">lib/adfs-id-provider/auth/sanitizeName</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_auth_sanitizeName.html#.sanitizeName">sanitizeName</a></li></ul></li><li><a href="module-lib_adfs-id-provider_auth_user.html">lib/adfs-id-provider/auth/user</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#.createOrUpdateFromJwt">createOrUpdateFromJwt</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#.getGroupKeys">getGroupKeys</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#.getGroups">getGroups</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#.getProfile">getProfile</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#.getRoles">getRoles</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#~createOrModify">createOrModify</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#~enrichProfileFromJwt">enrichProfileFromJwt</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#~modifyProfile">modifyProfile</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_auth_user.html#~setPathToValue">setPathToValue</a></li></ul></li><li><a href="module-lib_adfs-id-provider_context.html">lib/adfs-id-provider/context</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_context.html#.runAsAdmin">runAsAdmin</a></li></ul></li><li><a href="module-lib_adfs-id-provider_jwt.html">lib/adfs-id-provider/jwt</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_jwt.html#.fromAccessToken">fromAccessToken</a></li></ul></li><li><a href="module-lib_adfs-id-provider_oauth2.html">lib/adfs-id-provider/oauth2</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_oauth2.html#.redirectToAuthorizationUrl">redirectToAuthorizationUrl</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_oauth2.html#.requestAccessToken">requestAccessToken</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_oauth2.html#~getRedirectUri">getRedirectUri</a></li></ul></li><li><a href="module-lib_adfs-id-provider_object.html">lib/adfs-id-provider/object</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_object.html#.valueFromFormat">valueFromFormat</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_object.html#~isNotSet">isNotSet</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_object.html#~isSet">isSet</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_object.html#~toStr">toStr</a></li></ul></li><li><a href="module-lib_adfs-id-provider_portal.html">lib/adfs-id-provider/portal</a><ul class='methods'><li data-type='method'><a href="module-lib_adfs-id-provider_portal.html#.getReturnToUrl">getReturnToUrl</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_portal.html#~getAbsoluteSiteUrl">getAbsoluteSiteUrl</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_portal.html#~getAbsoluteUrlFromPath">getAbsoluteUrlFromPath</a></li><li data-type='method'><a href="module-lib_adfs-id-provider_portal.html#~isAbsoluteUrl">isAbsoluteUrl</a></li></ul></li><li><a href="module-site_filters_isAccessTokenExpired.html">site/filters/isAccessTokenExpired</a><ul class='methods'><li data-type='method'><a href="module-site_filters_isAccessTokenExpired.html#.responseFilter">responseFilter</a></li></ul></li><li><a href="module-site_parts_authentication.html">site/parts/authentication</a><ul class='methods'><li data-type='method'><a href="module-site_parts_authentication.html#.get">get</a></li></ul></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>ADFS ID provider</h1><!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc">DocToc</a></em></p>
<ul>
<li><a href="#how-to-use">How to use</a><ul>
<li><a href="#example-idproviderurls">Example idproviderUrls</a></li>
</ul>
</li>
<li><a href="#how-to-make-a-site-use-a-specific-userstore">How to make a site use a specific userstore</a></li>
<li><a href="#how-to-test-the-id-provider-on-your-site">How to test the id provider on your site</a></li>
<li><a href="#how-to-test-the-id-provider-on-localhost">How to test the id provider on localhost</a></li>
<li><a href="#how-to-enable-debug-logging">How to enable debug logging</a></li>
<li><a href="#how-to-build-the-application">How to build the application</a></li>
<li><a href="#terms">Terms</a></li>
<li><a href="#compatibility">Compatibility</a></li>
<li><a href="#changelog">Changelog</a><ul>
<li><a href="#100">1.0.0</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2>How to use</h2><ol>
<li>Install the app so it is listed on the Enonic XP Applications page.</li>
<li>Create a userStore on Enonic XP Users page and configure it to use the app.<ul>
<li>The userStore name is important, and is part of the idproviderUrls, which must be allowed as redirectUris in AD.</li>
</ul>
</li>
<li>While you are there configure the required settings. Setup a client in ADFS with the same settings.</li>
<li>Configure the vhost file, so that your site uses the userstore you made.</li>
<li>If you want automatic logout when an access token expires, add the app to all the sites that uses a userstore with the idprovider. This enables a filter to run on every response from Enonic XP.</li>
</ol>
<h3>Example idproviderUrls</h3><pre class="prettyprint source"><code>http://example.com:8080/_/idprovider/adfs
http://example.com:8080/admin/portal/admin/draft/_/idprovider/adfs (used for access to admin)</code></pre><h2>How to make a site use a specific userstore</h2><p>Example of configuration in $XP_HOME/config/com.enonic.xp.web.vhost.cfg</p>
<pre class="prettyprint source"><code># The site itself
mapping.mysite.host = example.com
mapping.mysite.source = /
mapping.mysite.target = /portal/master/mysite
mapping.mysite.userStore = myuserstore

# Make admin available on the same host
mapping.mysiteadmin.host = example.com
mapping.mysiteadmin.source = /admin
mapping.mysiteadmin.target = /admin
mapping.mysiteadmin.userStore = myuserstore</code></pre><h2>How to test the id provider on your site</h2><pre class="prettyprint source"><code>You can either use the authentication part which provides a login/logout link,
or you can remove the Everyone role from the Permissions on some content under you site.</code></pre><h2>How to test the id provider on localhost</h2><p>Example configuration in /etc/hosts</p>
<pre class="prettyprint source"><code>127.0.0.1 example.com</code></pre><h2>How to enable debug logging</h2><p>Add the following to $XP_HOME/config/logback.xml</p>
<pre class="prettyprint source"><code>&lt;logger name=&quot;com.enonic.app.adfsidprovider&quot; additivity=&quot;false&quot;>
&lt;level value=&quot;DEBUG&quot; />
&lt;appender-ref ref=&quot;STDOUT&quot;/>
&lt;appender-ref ref=&quot;FILE&quot;/>
&lt;/logger></code></pre><h2>How to build the application</h2><pre class="prettyprint source"><code>./gradlew build</code></pre><h2>Terms</h2><table>
<thead>
<tr>
<th>AD FS</th>
<th>Enonic XP</th>
</tr>
</thead>
<tbody>
<tr>
<td>claim</td>
<td>A property in the jwt.payload</td>
</tr>
</tbody>
</table>
<h2>Compatibility</h2><table>
<thead>
<tr>
<th>Version</th>
<th>XP version</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0.0</td>
<td>6.9.2</td>
</tr>
</tbody>
</table>
<h2>Changelog</h2><h3>1.0.0</h3><ul>
<li>Initial version</li>
</ul></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Apr 17 2018 09:39:28 GMT+0200 (CEST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>